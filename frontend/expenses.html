<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <!-- <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      .container {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 80%;
        max-width: 600px;
      }
      h1 {
        margin-top: 0;
        color: #333;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      label {
        margin-bottom: 5px;
        color: #666;
      }
      input,
      select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }
      button[type="submit"] {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }
      button[type="submit"]:hover {
        background-color: #218838;
      }
      ul {
        list-style-type: none;
        padding: 0;
      }
      li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 10px;
        background-color: #fff;
      }
      .delete-btn {
        background-color: red;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
      }
      .delete-btn:hover {
        background-color: darkred;
      }
      .message {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
        font-size: 16px;
      }
      .message.success {
        background-color: #d4edda;
        color: #155724;
      }
      .message.error {
        background-color: #f8d7da;
        color: #721c24;
      }
    </style> -->
  </head>
  <body>
    <div class="container">
      <h1>Expense Tracker</h1>
      <form id="expenseForm">
        <label for="amount">Choose Expense Amount:</label>
        <input type="text" name="amount" id="amount" required />
        <label for="description">Choose Description:</label>
        <input type="text" name="description" id="description" required />
        <label for="category">Choose a Category:</label>
        <select name="category" id="category">
          <option value="fuel">Fuel</option>
          <option value="food">Food</option>
          <option value="electricity">Electricity</option>
          <option value="movie">Movie</option>
        </select>
        <button type="submit">Add Expense</button>
      </form>
      <div id="message" class="message"></div>
      <ul class="ulist" id="expenseList"></ul>
    </div>

    <script>
      const expenseForm = document.getElementById("expenseForm");
      const expenseList = document.getElementById("expenseList");
      const messageDiv = document.getElementById("message");
      const apiUrl = "http://localhost:5000/expenses";

      // Function to display a message
      function displayMessage(message, type) {
        messageDiv.textContent = message;
        messageDiv.className = `message ${type}`;
        setTimeout(() => {
          messageDiv.textContent = "";
          messageDiv.className = "message";
        }, 3000);
      }

      // Function to add an expense to the list
      function addExpenseToList(expense) {
        const li = document.createElement("li");
        li.dataset.id = expense.id; // Add data-id attribute to li for easy removal
        li.innerHTML = `
                ${expense.amount} - ${expense.description} - ${expense.category}
                <button class="delete-btn" data-id="${expense.id}">Delete</button>
            `;
        expenseList.appendChild(li);
      }

      // Fetch and display expenses
      function fetchExpenses() {
        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            expenseList.innerHTML = "";
            data.forEach((expense) => {
              addExpenseToList(expense);
            });
          })
          .catch((error) => {
            console.error("Error fetching expenses:", error);
            displayMessage("Error fetching expenses", "error");
          });
      }

      // Handle form submission to add expense
      expenseForm.addEventListener("submit", function (event) {
        event.preventDefault();
        const amount = document.getElementById("amount").value;
        const description = document.getElementById("description").value;
        const category = document.getElementById("category").value;

        const expenseData = { amount, description, category };

        fetch(apiUrl + "/addexpense", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(expenseData),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.message) {
              displayMessage(data.message, "success");
              fetchExpenses();
              expenseForm.reset();
            } else {
              displayMessage(data.message, "error");
            }
          })
          .catch((error) => {
            console.error("Error adding expense:", error);
            displayMessage("Error adding expense", "error");
          });
      });

      // Handle delete button click
      expenseList.addEventListener("click", function (event) {
        if (event.target.classList.contains("delete-btn")) {
          const id = event.target.getAttribute("data-id");

          fetch(`${apiUrl}/deleteexpense/${id}`, {
            method: "DELETE",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.message) {
                displayMessage(data.message, "success");
                const expenseItem = document.querySelector(
                  `li[data-id="${id}"]`
                );
                expenseItem.remove();
              } else {
                displayMessage(data.message, "error");
              }
            })
            .catch((error) => {
              console.error("Error deleting expense:", error);
              displayMessage("Error deleting expense", "error");
            });
        }
      });

      // Fetch expenses on page load
      document.addEventListener("DOMContentLoaded", fetchExpenses);
    </script>
  </body>
</html>
