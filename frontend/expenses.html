<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <!-- Uncomment the style block if needed
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 80%;
      max-width: 600px;
      position: relative;
    }
    h1 {
      margin-top: 0;
      color: #333;
    }
    .premium-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .premium-button:hover {
      background-color: #0056b3;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    label {
      margin-bottom: 5px;
      color: #666;
    }
    input,
    select {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button[type="submit"] {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button[type="submit"]:hover {
      background-color: #218838;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
      background-color: #fff;
    }
    .delete-btn {
      background-color: red;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background-color: darkred;
    }
    .message {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      font-size: 16px;
    }
    .message.success {
      background-color: #d4edda;
      color: #155724;
    }
    .message.error {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
  --></head>
  <body>
    <div class="container">
      <button class="premium-button" id="buyPremium">Buy Premium</button>
      <h1>Expense Tracker</h1>
      <form id="expenseForm">
        <label for="amount">Choose Expense Amount:</label>
        <input type="text" name="amount" id="amount" required />
        <label for="description">Choose Description:</label>
        <input type="text" name="description" id="description" required />
        <label for="category">Choose a Category:</label>
        <select name="category" id="category">
          <option value="fuel">Fuel</option>
          <option value="food">Food</option>
          <option value="electricity">Electricity</option>
          <option value="movie">Movie</option>
        </select>
        <button type="submit">Add Expense</button>
      </form>
      <div id="message" class="message"></div>
      <ul class="ulist" id="expenseList"></ul>
    </div>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const apiUrl = "http://localhost:5000/expenses";
        const expenseList = document.getElementById("expenseList");
        const messageDiv = document.getElementById("message");
        const buyPremiumButton = document.getElementById("buyPremium");

        const token = localStorage.getItem("token");

        async function fetchExpenses() {
          try {
            const response = await fetch(apiUrl, {
              headers: {
                "Content-Type": "application/json",
                Authorization: token,
              },
            });
            const { res, premium } = await response.json();
            expenseList.innerHTML = "";
            res.forEach((expense) => {
              const li = document.createElement("li");
              li.textContent = `${expense.amount} - ${expense.description} - ${expense.category}`;
              expenseList.appendChild(li);
            });

            if (premium) {
              buyPremiumButton.style.display = "none";
              messageDiv.textContent = "You are a premium user";
            } else {
              buyPremiumButton.style.display = "block";
            }
          } catch (error) {
            console.error("Error fetching expenses:", error);
            messageDiv.textContent = "Error fetching expenses";
          }
        }

        buyPremiumButton.addEventListener("click", async function () {
          try {
            const response = await fetch(
              "http://localhost:5000/purchase/premiummembership",
              {
                method: "POST",
                headers: {
                  Authorization: token,
                },
              }
            );
            const { razorpayOrderId, razorpayKey, name, email } =
              await response.json();

            const options = {
              key: razorpayKey,
              order_id: razorpayOrderId,
              handler: async function (response) {
                try {
                  const updateResponse = await fetch(
                    "http://localhost:5000/purchase/updatetransactionstatus",
                    {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json",
                        Authorization: token,
                      },
                      body: JSON.stringify({
                        orderId: response.razorpay_order_id,
                        paymentId: response.razorpay_payment_id,
                        status: "SUCCESS",
                      }),
                    }
                  );
                  const updateResult = await updateResponse.json();
                  localStorage.setItem("token", updateResult.token);
                  messageDiv.textContent = "You are a premium user now!";
                  buyPremiumButton.style.display = "none";
                } catch (updateError) {
                  console.error(
                    "Error updating transaction status:",
                    updateError
                  );
                  messageDiv.textContent = "Error updating transaction status";
                }
              },
              prefill: {
                name,
                email,
              },
            };

            const rzp1 = new Razorpay(options);
            rzp1.open();
          } catch (error) {
            console.error("Error initiating premium membership:", error);
            messageDiv.textContent = "Error initiating premium membership";
          }
        });

        fetchExpenses();
      });
    </script>
  </body>
</html>
